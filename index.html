<!DOCTYPE html>
<html lang="es">
<head>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>P2P Analytics Bolivia - El Mejor Momento para Comprar y Vender USDT</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .hero-gradient {
            background: linear-gradient(145deg, #f0f9ff 0%, #e0f2fe 100%);
        }preview
        .feature-icon {
            background: #0ea5e9; /* Light Blue */
            color: white;
        }
        .ai-gradient {
            background: linear-gradient(160deg, #f0f9ff 0%, #ffffff 100%);
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-white text-gray-800">

    <!-- Header -->
    <header class="bg-white shadow-sm sticky top-0 z-50">
        <div class="container mx-auto px-6 py-4 flex justify-between items-center">
            <div class="text-2xl font-bold text-gray-900">
                <span class="text-sky-500">P2P</span> Analytics
            </div>
            <nav class="hidden md:flex space-x-8">
                <a href="#features" class="text-gray-600 hover:text-sky-500">Características</a>
                <a href="#ai-features" class="text-gray-600 hover:text-sky-500">Análisis IA</a>
                <a href="#preview" class="text-gray-600 hover:text-sky-500">Vista Previa</a>
                <a href="#register" class="text-gray-600 hover:text-sky-500">Acceso Anticipado</a>
            </nav>
            <a href="#register" class="bg-sky-500 text-white font-semibold px-5 py-2 rounded-lg hover:bg-sky-600 transition-colors">
                Regístrate Gratis
            </a>
        </div>
    </header>

    <!-- Hero Section -->
    <main class="hero-gradient">
        <div class="container mx-auto px-6 py-20 md:py-32 text-center">
            <h1 class="text-4xl md:text-6xl font-bold text-gray-900 leading-tight mb-4">
                Deja de Adivinar. <br class="hidden md:block"> <span class="text-sky-600">Encuentra el Mejor Precio</span> para tu USDT.
            </h1>
            <p class="text-lg md:text-xl text-gray-700 max-w-3xl mx-auto mb-8">
                Nuestra plataforma analiza el mercado P2P de Binance en Bolivia en tiempo real y ahora, con el poder de la IA, te ofrece análisis y estrategias para tomar decisiones inteligentes.
            </p>
            <a href="#register" class="bg-sky-500 text-white font-bold px-8 py-4 rounded-lg text-lg hover:bg-sky-600 transition-transform transform hover:scale-105">
                Obtener Acceso Anticipado
            </a>
        </div>
    </main>

    <!-- Features Section -->
    <section id="features" class="py-20 bg-white">
        <div class="container mx-auto px-6">
            <h2 class="text-3xl font-bold text-center mb-12">Todo lo que Necesitas para Operar con Éxito</h2>
            <div class="grid md:grid-cols-3 gap-10">
                <!-- Feature 1 -->
                <div class="text-center">
                    <div class="w-16 h-16 feature-icon rounded-full flex items-center justify-center mx-auto mb-4">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" /></svg>
                    </div>
                    <h3 class="text-xl font-semibold mb-2">Análisis de Tendencia</h3>
                    <p class="text-gray-600">Visualiza la evolución del precio con gráficos claros y sencillos. Identifica la dirección del mercado al instante.</p>
                </div>
                <!-- Feature 2 -->
                <div class="text-center">
                    <div class="w-16 h-16 feature-icon rounded-full flex items-center justify-center mx-auto mb-4">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                    </div>
                    <h3 class="text-xl font-semibold mb-2">Momentos Óptimos</h3>
                    <p class="text-gray-600">Nuestra IA analiza los datos para marcarte los mejores momentos históricos para comprar (precios bajos) y vender (precios altos).</p>
                </div>
                <!-- Feature 3 -->
                <div class="text-center">
                    <div class="w-16 h-16 feature-icon rounded-full flex items-center justify-center mx-auto mb-4">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" /></svg>
                    </div>
                    <h3 class="text-xl font-semibold mb-2">Detección de Volatilidad</h3>
                    <p class="text-gray-600">Identifica fácilmente si el mercado está en un período de calma (ideal para analizar) o agitado (ideal para operar con cautela).</p>
                </div>
            </div>
        </div>
    </section>

    <!-- AI Features Section -->
    <section id="ai-features" class="py-20 ai-gradient">
        <div class="container mx-auto px-6">
            <div class="text-center mb-16">
                <h2 class="text-3xl md:text-4xl font-bold">Potenciado por IA de Gemini</h2>
                <p class="text-lg text-gray-600 mt-2">Obtén análisis y estrategias personalizadas al instante.</p>
            </div>
            <div class="grid md:grid-cols-2 gap-12 items-start">
                <!-- AI Market Analysis -->
                <div class="bg-white p-8 rounded-xl shadow-lg">
                    <h3 class="text-2xl font-bold mb-4">Análisis del Mercado con IA ✨</h3>
                    <p class="text-gray-600 mb-6">Presiona el botón para obtener un resumen instantáneo del estado del mercado, generado por IA. Ideal para saber qué está pasando de un solo vistazo.</p>
                    <button id="analyze-market-btn" class="w-full bg-sky-500 text-white font-semibold px-6 py-3 rounded-lg hover:bg-sky-600 transition-colors">
                        Analizar Mercado Ahora
                    </button>
                    <div id="market-analysis-loader" class="hidden mx-auto my-4 loader"></div>
                    <div id="market-analysis-result" class="mt-6 p-4 bg-sky-50 rounded-lg text-gray-700 hidden"></div>
                </div>

                <!-- AI Strategy Generator -->
                <div class="bg-white p-8 rounded-xl shadow-lg">
                    <h3 class="text-2xl font-bold mb-4">Generador de Estrategias ✨</h3>
                    <p class="text-gray-600 mb-4">Selecciona tu perfil de inversor y nuestra IA creará una estrategia educativa simple para ti. (Esto no es un consejo financiero).</p>
                    <div class="mb-4">
                        <label for="profile-select" class="block text-sm font-medium text-gray-700 mb-2">Selecciona tu perfil:</label>
                        <select id="profile-select" class="w-full px-4 py-3 rounded-lg border-gray-300 focus:outline-none focus:ring-2 focus:ring-sky-300">
                            <option value="Conservador">Conservador (Bajo Riesgo)</option>
                            <option value="Moderado">Moderado (Equilibrado)</option>
                            <option value="Agresivo">Agresivo (Alto Riesgo/Recompensa)</option>
                        </select>
                    </div>
                    <button id="generate-strategy-btn" class="w-full bg-indigo-500 text-white font-semibold px-6 py-3 rounded-lg hover:bg-indigo-600 transition-colors">
                        Generar mi Estrategia
                    </button>
                    <div id="strategy-loader" class="hidden mx-auto my-4 loader"></div>
                    <div id="strategy-result" class="mt-6 p-4 bg-indigo-50 rounded-lg text-gray-700 hidden"></div>
                </div>
            </div>
        </div>
    </section>

    <!-- Preview Section -->
    <!-- <section id="preview" class="py-20 bg-gray-50">
        <div class="container mx-auto px-6">
            <h2 class="text-3xl font-bold text-center mb-8">Una Herramienta Intuitiva y Poderosa</h2>
            <div class="bg-white rounded-lg shadow-2xl p-4 md:p-8">
                <img src="https://i.imgur.com/uG9s04N.png" alt="Vista previa del dashboard de P2P Analytics" class="rounded-md w-full">
            </div>
        </div>
    </section> -->
    
    <section id="preview" class="py-20 bg-gray-50">
    <div class="container mx-auto px-6">
        <h2 class="text-3xl font-bold text-center mb-8">Análisis de Precios en Tiempo Real</h2>
        <div class="bg-white rounded-lg shadow-2xl p-4 md:p-8">
            <canvas id="priceChart"></canvas>
        </div>
    </div>
    </section>
    
    <!-- Registration Section -->
    <section id="register" class="bg-sky-600 text-white">
        <div class="container mx-auto px-6 py-20 text-center">
            <h2 class="text-3xl font-bold mb-4">Únete a la Lista de Espera y Sé el Primero en Probarlo</h2>
            <p class="text-sky-100 max-w-2xl mx-auto mb-8">Regístrate ahora para obtener acceso anticipado gratuito. Te notificaremos en cuanto la plataforma esté lista para ti.</p>
            
            <div id="registration-form" class="max-w-lg mx-auto">
                <div class="flex flex-col md:flex-row gap-4 mb-4">
                    <input type="text" id="name" placeholder="Tu Nombre" class="w-full px-4 py-3 rounded-lg text-gray-800 focus:outline-none focus:ring-2 focus:ring-sky-300" required>
                    <input type="email" id="email" placeholder="Tu Correo Electrónico" class="w-full px-4 py-3 rounded-lg text-gray-800 focus:outline-none focus:ring-2 focus:ring-sky-300" required>
                </div>
                <button id="submit-button" class="w-full bg-white text-sky-600 font-bold px-8 py-4 rounded-lg text-lg hover:bg-sky-50 transition-colors">
                    ¡Quiero mi Acceso!
                </button>
            </div>
            <div id="success-message" class="hidden text-center p-6 bg-green-500/20 rounded-lg">
                <h3 class="text-2xl font-bold">¡Gracias por registrarte!</h3>
                <p class="mt-2">Te hemos añadido a la lista de acceso anticipado. Recibirás un correo electrónico tan pronto como la plataforma esté disponible.</p>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white">
        <div class="container mx-auto px-6 py-8 text-center">
            <p>&copy; 2025 P2P Analytics Bolivia. Todos los derechos reservados.</p>
            <p class="text-sm text-gray-400 mt-2">Una herramienta para la comunidad de criptomonedas en Bolivia.</p>
        </div>
    </footer>

    <!-- Firebase SDK y Lógica de Registro -->
    <script type="module">
        // Importa las funciones que necesitas de los SDKs
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // TODO: Reemplaza esto con la configuración de tu propio proyecto de Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyAaJ4ELW_HLcjlHXDVIASrPpctWMIHYeIo",
            authDomain: "p2p-analytics-bolivia.firebaseapp.com",
            projectId: "p2p-analytics-bolivia",
            storageBucket: "p2p-analytics-bolivia.firebasestorage.app",
            messagingSenderId: "681190831507",
            appId: "1:681190831507:web:7ce2211b0356ac5b20e466",
            measurementId: "G-NVNVSYDJ46"
        };

        // Inicializa Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Lógica del formulario de registro
        const submitButton = document.getElementById('submit-button');
        const nameInput = document.getElementById('name');
        const emailInput = document.getElementById('email');
        const registrationForm = document.getElementById('registration-form');
        const successMessage = document.getElementById('success-message');

        submitButton.addEventListener('click', async () => {
            const name = nameInput.value.trim();
            const email = emailInput.value.trim();

            if (name === '' || email === '') {
                alert('Por favor, completa tu nombre y correo.');
                return;
            }
            if (!/^\S+@\S+\.\S+$/.test(email)) {
                alert('Por favor, introduce un correo electrónico válido.');
                return;
            }

            submitButton.disabled = true;
            submitButton.textContent = 'Registrando...';

            try {
                const docRef = await addDoc(collection(db, "leads"), {
                    name: name,
                    email: email,
                    registeredAt: serverTimestamp()
                });
                console.log("Document written with ID: ", docRef.id);
                registrationForm.classList.add('hidden');
                successMessage.classList.remove('hidden');
            } catch (e) {
                console.error("Error adding document: ", e);
                alert('Hubo un error al registrar tus datos. Por favor, inténtalo de nuevo.');
                submitButton.disabled = false;
                submitButton.textContent = '¡Quiero mi Acceso!';
            }
        });

        // --- LÓGICA DE LA API DE GEMINI ---
        const geminiApiKey = ""; // NO se necesita una clave para el modelo Flash

        // Función para convertir Markdown simple a HTML
        function markdownToHtml(text) {
            return text
                .replace(/\*\*(.*?)\*\*/g, '<b>$1</b>') // Negrita
                .replace(/\*(.*?)\*/g, '<i>$1</i>')   // Cursiva
                .replace(/\n/g, '<br>');              // Saltos de línea
        }

        async function callGemini(prompt, button, loader, resultDiv) {
            button.disabled = true;
            loader.classList.remove('hidden');
            resultDiv.classList.add('hidden');

            const payload = {
                contents: [{ role: "user", parts: [{ text: prompt }] }]
            };

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${geminiApiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`API Error: ${response.status}`);
                }
                
                const result = await response.json();
                
                if (result.candidates && result.candidates.length > 0) {
                    const rawText = result.candidates[0].content.parts[0].text;
                    resultDiv.innerHTML = markdownToHtml(rawText); // Convierte Markdown y muestra el resultado
                    resultDiv.classList.remove('hidden');
                } else {
                    throw new Error("No se recibió contenido válido de la API.");
                }

            } catch (error) {
                console.error("Error calling Gemini API:", error);
                resultDiv.textContent = "Hubo un error al contactar a la IA. Por favor, intenta de nuevo más tarde.";
                resultDiv.classList.remove('hidden');
            } finally {
                button.disabled = false;
                loader.classList.add('hidden');
            }
        }

        // Lógica para el Análisis de Mercado
        const analyzeMarketBtn = document.getElementById('analyze-market-btn');
        const marketLoader = document.getElementById('market-analysis-loader');
        const marketResultDiv = document.getElementById('market-analysis-result');

        analyzeMarketBtn.addEventListener('click', () => {
            const prompt = "Actúa como un analista financiero experto en el mercado P2P de criptomonedas en Bolivia. Basado en una supuesta tendencia de precios ligeramente a la baja en las últimas 24 horas, con picos de volatilidad por la mañana, escribe un breve resumen (3-4 frases) para un principiante. Explica qué significa esto y qué precaución debería tomar. Usa un tono amigable y educativo. **Formatea tu respuesta usando negritas para los puntos clave y añade emojis relevantes (como 📉, 📈, 💡) para que sea más visual y amigable.**";
            callGemini(prompt, analyzeMarketBtn, marketLoader, marketResultDiv);
        });

        // Lógica para el Generador de Estrategias
        const generateStrategyBtn = document.getElementById('generate-strategy-btn');
        const profileSelect = document.getElementById('profile-select');
        const strategyLoader = document.getElementById('strategy-loader');
        const strategyResultDiv = document.getElementById('strategy-result');

        generateStrategyBtn.addEventListener('click', () => {
            const userProfile = profileSelect.value;
            const prompt = `Actúa como un asesor de trading educativo. Un usuario con un perfil **'${userProfile}'** quiere una estrategia simple para el mercado P2P en Bolivia. Describe una estrategia de 3 pasos que se enfoque en el perfil del usuario. Por ejemplo, para un perfil conservador, enfócate en minimizar riesgos. Para un perfil agresivo, en maximizar ganancias. El objetivo es puramente educativo, no es un consejo financiero. **Formatea la respuesta con negritas y emojis para cada paso (como 🎯, 🛡️, 🚀).** Mantén el texto corto, en español y fácil de entender.`;
            callGemini(prompt, generateStrategyBtn, strategyLoader, strategyResultDiv);
                });
        // (Dentro de tu <script type="module"> existente)

        // --- LÓGICA DEL GRÁFICO DE PRECIOS ---
        const API_URL = "https://p2p-analytics-bolivia-681190831507.us-central1.run.app"; // <-- ¡TU URL DE CLOUD RUN!

        async function fetchAndDrawChart() {
            try {
                // Llama a tu nueva API
                const response = await fetch(`${API_URL}/api/price-analytics?days=7&trade_type=SELL&frequency=1H`);
                if (!response.ok) {
                    throw new Error(`Error en la API: ${response.statusText}`);
                }
                const data = await response.json();

                // Prepara los datos para Chart.js
                const labels = data.metrics.map(d => new Date(d.timestamp).toLocaleString());
                const prices = data.metrics.map(d => d.precio_promedio);

                const buyMoments = data.buy_moments.map(d => ({
                    x: new Date(d.timestamp).toLocaleString(),
                    y: d.precio_promedio
                }));

                // Dibuja el gráfico
                const ctx = document.getElementById('priceChart').getContext('2d');
                new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Precio Promedio de Compra (Bs.)',
                            data: prices,
                            borderColor: 'rgb(54, 162, 235)',
                            tension: 0.1
                        }, {
                            label: 'Buen Momento para Comprar',
                            data: buyMoments,
                            type: 'scatter',
                            backgroundColor: 'rgb(75, 192, 192)',
                            radius: 6,
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: { position: 'top' },
                            title: { display: true, text: 'Evolución del Precio USDT (Últimos 7 días)'}
                        }
                    }
                });

            } catch (error) {
                console.error("No se pudo cargar el gráfico:", error);
                // Podrías mostrar un mensaje de error en la UI
            }
        }

        // Llama a la función cuando la página se cargue
        document.addEventListener('DOMContentLoaded', fetchAndDrawChart);
    </script>
</body>
</html>
